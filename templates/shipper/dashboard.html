{% extends "base.html" %}

{% block title %}Shipper Dashboard - FastFood{% endblock %}

{% block extra_css %}
<style>
    /* --- CSS CHO SHIPPER DASHBOARD --- */

    /* 1. Header */
    .welcome-text h2 {
        font-weight: 800;
        color: #333;
        letter-spacing: -0.5px;
    }

    /* 2. Stats Cards */
    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        border: 1px solid #f0f0f0;
    }

    .stat-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        margin-bottom: 15px;
    }

    .stat-value {
        font-size: 1.8rem;
        font-weight: 800;
        line-height: 1;
    }

    .stat-label {
        color: #666;
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* 3. Available Orders (ƒê∆°n m·ªõi) */
    .order-card-new {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .order-card-new:hover {
        transform: translateY(-5px);
        border-color: #ff5b00;
    }

    .order-head {
        background: #fff;
        padding: 15px;
        border-bottom: 1px dashed #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .order-price-lg {
        color: #ff5b00;
        font-weight: 800;
        font-size: 1.2rem;
    }

    .order-body {
        padding: 15px;
        flex-grow: 1;
    }

    .btn-accept {
        width: 100%;
        background: #ff5b00;
        color: white;
        font-weight: 700;
        padding: 12px;
        border: none;
        transition: 0.2s;
    }

    .btn-accept:hover {
        background: #e04f00;
        color: white;
    }

    /* 4. Table My Orders */
    .table-custom th {
        background: #f8f9fa;
        color: #666;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8rem;
    }

    .table-custom td {
        vertical-align: middle;
        padding: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">

    <div class="mb-5">
        <div class="welcome-text">
            <h2 class="mb-1">Xin ch√†o, {{ user.get('name', 'B√°c t√†i') }}! <span class="fs-4">üëã</span></h2>
            <p class="text-muted mb-0">Ch√∫c b·∫°n m·ªôt ng√†y l√†m vi·ªác an to√†n v√† hi·ªáu qu·∫£.</p>
        </div>
    </div>

    <div class="row g-3 mb-5">
        <div class="col-6 col-md-3">
            <div class="stat-card border-bottom border-4 border-success">
                <div class="stat-icon bg-success bg-opacity-10 text-success">
                    <i class="bi bi-cash-stack"></i>
                </div>
                <div>
                    <div class="stat-value text-success">{{ "{:,.0f}".format(stats.get('delivery_earnings', 0)) }}ƒë
                    </div>
                    <div class="stat-label">Thu nh·∫≠p ship</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                    <i class="bi bi-box-seam"></i>
                </div>
                <div>
                    <div class="stat-value text-dark">{{ stats.total_orders or 0 }}</div>
                    <div class="stat-label">T·ªïng ƒë∆°n nh·∫≠n</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <div class="stat-icon bg-info bg-opacity-10 text-info">
                    <i class="bi bi-check2-circle"></i>
                </div>
                <div>
                    <div class="stat-value text-dark">{{ stats.completed_orders or 0 }}</div>
                    <div class="stat-label">ƒê√£ ho√†n th√†nh</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <div class="stat-icon bg-warning bg-opacity-10 text-warning">
                    <i class="bi bi-star-fill"></i>
                </div>
                <div>
                    <div class="stat-value text-dark">{{ stats.avg_rating or 0 }}</div>
                    <div class="stat-label">ƒê√°nh gi√° TB</div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex align-items-center mb-3">
        <h4 class="fw-bold mb-0 text-dark me-2">ƒê∆°n h√†ng m·ªõi</h4>
        {% if available_orders %}
        <span class="badge bg-danger rounded-pill animate__animated animate__pulse animate__infinite">
            {{ available_orders|length }} ƒë∆°n
        </span>
        {% endif %}
    </div>

    {% if available_orders %}
    <div class="row g-4 mb-5">
        {% for order in available_orders %}
        <div class="col-md-6 col-lg-4">
            <div class="order-card-new">
                <div class="order-head">
                    <span class="badge bg-light text-dark border">
                        #{{ order._id|string|truncate(6, True, '')|upper }}
                    </span>
                    <span class="order-price-lg">
                        {{ "{:,.0f}".format(order.get('total', 0)) }}ƒë
                    </span>
                </div>
                <div class="order-body">
                    <div class="d-flex mb-3">
                        <i class="bi bi-shop text-warning me-3 fs-5"></i>
                        <div>
                            <small class="text-muted d-block text-uppercase" style="font-size: 0.7rem;">ƒêi·ªÉm l·∫•y
                                h√†ng</small>
                            <span class="fw-bold text-dark">Nh√† h√†ng FastFood</span>
                        </div>
                    </div>
                    <div class="d-flex mb-3">
                        <i class="bi bi-geo-alt text-danger me-3 fs-5"></i>
                        <div>
                            <small class="text-muted d-block text-uppercase" style="font-size: 0.7rem;">ƒêi·ªÉm
                                giao</small>
                            <span class="fw-bold text-dark">{{ order.get('delivery_address', 'ƒê·ªãa ch·ªâ kh√°ch h√†ng')
                                }}</span>
                        </div>
                    </div>
                </div>
                <div class="order-footer">
                    <form method="POST" action="{{ url_for('shipper.accept_order', order_id=order._id) }}">
                        <button type="submit" class="btn btn-accept">
                            NH·∫¨N ƒê∆†N NGAY <i class="bi bi-arrow-right"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5 bg-white rounded-3 shadow-sm mb-5 border border-dashed">
        <img src="https://cdn-icons-png.flaticon.com/512/7486/7486747.png" width="80" class="mb-3 opacity-50">
        <h5 class="text-muted fw-bold">Hi·ªán ch∆∞a c√≥ ƒë∆°n h√†ng m·ªõi</h5>
        <p class="text-muted small">Vui l√≤ng quay l·∫°i sau nh√©!</p>
    </div>
    {% endif %}

    <h4 class="fw-bold mb-3 text-dark">ƒê∆°n h√†ng c·ªßa t√¥i</h4>
    <div class="card border-0 shadow-sm rounded-3 overflow-hidden">
        <div class="card-body p-0">
            {% if my_orders %}
            <div class="table-responsive">
                <table class="table table-custom table-hover mb-0">
                    <thead>
                        <tr>
                            <th class="ps-4">M√£ ƒë∆°n</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th class="text-end pe-4">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in my_orders %}
                        <tr>
                            <td class="ps-4 fw-bold">#{{ order._id|string|truncate(8, True, '')|upper }}</td>
                            <td class="fw-bold text-success">{{ "{:,.0f}".format(order.get('total', 0)) }}ƒë</td>
                            <td>
                                {% if order.get('status') == 'delivering' %}
                                <span
                                    class="badge bg-primary bg-opacity-10 text-primary border border-primary px-3 py-1 rounded-pill">
                                    <i class="bi bi-bicycle me-1"></i> ƒêang giao
                                </span>
                                {% elif order.get('status') == 'delivered' %}
                                <span
                                    class="badge bg-success bg-opacity-10 text-success border border-success px-3 py-1 rounded-pill">
                                    Ho√†n th√†nh
                                </span>
                                {% else %}
                                <span
                                    class="badge bg-warning bg-opacity-10 text-dark border border-warning px-3 py-1 rounded-pill">
                                    {{ order.get('status') }}
                                </span>
                                {% endif %}
                            </td>
                            <td class="text-end pe-4">
                                <a href="{{ url_for('shipper.order_detail', order_id=order._id) }}"
                                    class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                    Chi ti·∫øt <i class="bi bi-chevron-right"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted mb-0">B·∫°n ch∆∞a nh·∫≠n ƒë∆°n h√†ng n√†o.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}