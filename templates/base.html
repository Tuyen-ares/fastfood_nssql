<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}FastFood Delivery{% endblock %}</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="{{ url_for('static', filename='css/style.css') }}"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary-orange: #ff5b00;
        --text-dark: #1a1a1a;
        --text-gray: #6c757d;
        --bg-light: #f8f9fa;
      }

      body {
        font-family: "Segoe UI", Roboto, sans-serif;
        background-color: var(--bg-light);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        /* Luôn có padding top vì Header màu trắng cố định */
        padding-top: 80px;
      }

      /* --- 1. HEADER STYLE MỚI (TRẮNG) --- */
      .navbar-custom {
        background-color: #ffffff !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        /* Bóng mờ nhẹ */
        padding: 12px 0;
        transition: all 0.3s ease;
      }

      /* Logo Icon (Hình vuông cam bo góc) */
      .logo-box {
        width: 42px;
        height: 42px;
        background-color: var(--primary-orange);
        color: white;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        margin-right: 10px;
      }

      .navbar-brand {
        font-weight: 800;
        font-size: 1.6rem;
        color: #111827 !important;
        /* Chữ màu đen đậm */
        letter-spacing: -0.5px;
      }

      /* Menu Links */
      .nav-link {
        font-weight: 600;
        margin: 0 15px;
        color: #4b5563 !important;
        /* Màu xám đậm */
        transition: color 0.2s;
        font-size: 1rem;
      }

      .nav-link:hover,
      .nav-link.active {
        color: var(--primary-orange) !important;
        /* Hover màu cam */
      }

      /* User Avatar */
      .user-avatar {
        width: 38px;
        height: 38px;
        background-color: #f3f4f6;
        /* Nền xám nhạt */
        color: var(--primary-orange);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 10px;
        border: 2px solid white;
        box-shadow: 0 0 0 1px #e5e7eb;
      }

      /* --- 2. FOOTER STYLE --- */
      footer.main-footer {
        background-color: #111827;
        color: #9ca3af;
        padding-top: 60px;
        padding-bottom: 30px;
        margin-top: auto;
      }

      footer a {
        color: #9ca3af;
        text-decoration: none;
        transition: 0.2s;
      }

      footer a:hover {
        color: var(--primary-orange);
      }

      /* Mobile Toggler color fix */
      .navbar-toggler {
        border: none;
        padding: 0;
      }

      .navbar-toggler:focus {
        box-shadow: none;
      }

      .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(0, 0, 0, 0.7)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
      }
    </style>

    {% block extra_css %}{% endblock %}
  </head>

  <body>
    <nav class="navbar navbar-expand-lg fixed-top navbar-custom" id="mainNav">
      <div class="container">
        <a
          class="navbar-brand d-flex align-items-center"
          href="{% if session.user_role == 'admin' %}
                    {{ url_for('admin.dashboard') }}
                {% elif session.user_role == 'restaurant_owner' %}
                    {{ url_for('restaurant.dashboard') }}
                {% elif session.user_role == 'shipper' %}
                    {{ url_for('shipper.dashboard') }}
                {% else %}
                    {{ url_for('main.index') }}
                {% endif %}"
        >
          <div class="logo-box">
            <i class="bi bi-bag-fill"></i>
          </div>
          FastFood
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mx-auto align-items-center">
            {% if not session.user_id or session.user_role == 'customer' %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.index') }}"
                >Trang chủ</a
              >
            </li>
            {% endif %}
            {% if session.user_id %}
              {% if session.user_role == 'customer' %}
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('customer.restaurants') }}"
                  >Đặt món ăn</a
                >
              </li>
              <li class="nav-item position-relative">
                <a class="nav-link" href="{{ url_for('customer.cart') }}">
                  Giỏ hàng {% if session.cart %}
                  <span
                    class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-white"
                  >
                    {{ session.cart|length }}
                  </span>
                  {% endif %}
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('customer.reviews') }}"
                  >Đánh giá</a
                >
              </li>

              {% elif session.user_role == 'admin' %}
              <li class="nav-item">
                <a class="nav-link active" href="{{ url_for('admin.dashboard') }}"
                  >Dashboard</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('admin.users') }}"
                  >Quản lý người dùng</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('admin.restaurants') }}"
                  >Quản lý nhà hàng</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="{{ url_for('admin.restaurant_owners') }}"
                  >Quản lý chủ nhà hàng</a
                >
              </li>

              {% elif session.user_role == 'shipper' %}
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'shipper.dashboard' %}active{% endif %}"
                  href="{{ url_for('shipper.dashboard') }}"
                  >Dashboard</a
                >
              </li>

              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'shipper.orders' %}active{% endif %}"
                  href="{{ url_for('shipper.orders') }}"
                  >Đơn hàng</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'shipper.reviews' %}active{% endif %}"
                  href="{{ url_for('shipper.reviews') }}"
                  >Đánh giá</a
                >
              </li>
              {% elif session.user_role == 'restaurant_owner' %}
              <li class="nav-item">
                <a
                  class="nav-link active"
                  href="{{ url_for('restaurant.dashboard') }}"
                  >Dashboard</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('restaurant.menus') }}"
                  >Món ăn</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('restaurant.orders') }}"
                  >Đơn hàng</a
                >
              </li>
              {% endif %}
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('customer.restaurants') }}"
                >Nhà hàng</a
              >
            </li>
            <li class="nav-item"><a class="nav-link" href="#">Đánh giá</a></li>
            {% endif %}
          </ul>

          <ul class="navbar-nav ms-auto align-items-center">
            {% if session.user_id %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle d-flex align-items-center"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <div class="user-avatar">
                  {{ session.user_name[0] | upper if session.user_name else 'U' }}
                </div>
                <span class="text-dark fw-bold">{{ session.user_name }}</span>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 p-2"
                style="border-radius: 12px"
              >
                {% if session.user_role == 'customer' %}
                <li>
                  <a
                    class="dropdown-item rounded py-2"
                    href="{{ url_for('customer.dashboard') }}"
                    ><i class="bi bi-speedometer2 me-2"></i> Dashboard</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item rounded py-2"
                    href="{{ url_for('customer.orders') }}"
                    ><i class="bi bi-receipt me-2"></i> Đơn hàng</a
                  >
                </li>
                {% elif session.user_role == 'shipper' %}
                <li>
                  <a
                    class="dropdown-item rounded py-2"
                    href="{{ url_for('shipper.stats') }}"
                    ><i class="bi bi-graph-up me-2"></i> Thống kê</a
                  >
                </li>
                {% endif %}
                <li>
                  <hr class="dropdown-divider" />
                </li>
                <li>
                  <a
                    class="dropdown-item rounded py-2 text-danger"
                    href="{{ url_for('auth.logout') }}"
                    ><i class="bi bi-box-arrow-right me-2"></i> Đăng xuất</a
                  >
                </li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link fw-bold" href="{{ url_for('auth.login') }}"
                >Đăng nhập</a
              >
            </li>
            <li class="nav-item ms-2">
              <a
                class="btn btn-warning text-white rounded-pill px-4 fw-bold shadow-sm"
                style="background-color: var(--primary-orange); border: none"
                href="{{ url_for('auth.register') }}"
                >Đăng ký</a
              >
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="container" style="margin-top: 20px">
          {% for category, message in messages %}
          <div
            class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show shadow-sm"
            role="alert"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <main>{% block content %}{% endblock %}</main>

    {% if not session.user_id or session.user_role == 'customer' %}
    <footer class="main-footer">
      <div class="container">
        <div class="row gy-4">
          <div class="col-lg-4 col-md-6">
            <h4 class="text-white mb-3 fw-bold">FastFood</h4>
            <p class="small mb-4">
              Mang đến trải nghiệm ẩm thực tuyệt vời ngay tại nhà của bạn. Nhanh
              chóng, tiện lợi và chất lượng hàng đầu.
            </p>
          </div>
          <div class="col-lg-2 col-md-6">
            <h5 class="text-white mb-3 fw-bold" style="font-size: 1.1rem">
              Liên kết
            </h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <a href="{{ url_for('main.index') }}">Trang chủ</a>
              </li>
              <li class="mb-2">
                <a href="{{ url_for('customer.restaurants') }}">Thực đơn</a>
              </li>
              <li class="mb-2"><a href="#">Tuyển dụng</a></li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-6">
            <h5 class="text-white mb-3 fw-bold" style="font-size: 1.1rem">
              Hỗ trợ
            </h5>
            <ul class="list-unstyled">
              <li class="mb-2"><a href="#">Trung tâm trợ giúp</a></li>
              <li class="mb-2"><a href="#">Chính sách bảo mật</a></li>
            </ul>
          </div>
          <div class="col-lg-4 col-md-6">
            <h5 class="text-white mb-3 fw-bold" style="font-size: 1.1rem">
              Liên hệ
            </h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="bi bi-geo-alt text-warning me-2"></i> Quận 1, TP. HCM
              </li>
              <li class="mb-2">
                <i class="bi bi-telephone text-warning me-2"></i> 1900 123 456
              </li>
              <li class="mb-2">
                <i class="bi bi-envelope text-warning me-2"></i>
                hotro@fastfood.vn
              </li>
            </ul>
          </div>
        </div>
        <div class="border-top border-secondary mt-4 pt-4 text-center small">
          &copy; 2025 FastFood Company.
        </div>
      </div>
    </footer>
    {% endif %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
  </body>
</html>
